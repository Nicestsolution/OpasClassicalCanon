<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Opa's klassieke canon</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    margin: 1rem;
    line-height: 1.6;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .song-block {
    margin-bottom: 2rem;
    border-bottom: 1px solid #ccc;
    padding-bottom: 1rem;
  }

  .collapsed {
    cursor: pointer;
    font-weight: bold;
    color: #003366;
    padding: 0.5rem;
    background-color: #f0f0f0;
    border-radius: 4px;
  }

  .collapsed:hover {
    background-color: #e0e0e0;
  }

  .expanded {
    margin-top: 0.5rem;
  }

  h3 {
    font-size: 1.2rem;
    margin-bottom: 0.3rem;
  }

  iframe, audio {
    max-width: 100%;
  }

  @media (max-width: 600px) {
    body {
      font-size: 1rem;
    }

    h3 {
      font-size: 1rem;
    }

    .collapsed {
      font-size: 1rem;
    }
  }
</style>
</head>
<body>
  	<h1>Opa's klassieke canon</h1>
	<div id="playlist"></div>
  	<div id="content"></div>

  <script>
    fetch('./canon.xml')
    .then(response => response.text())
    .then(xmlText => {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, "application/xml");
    const composers = xmlDoc.querySelectorAll("composer");
    const songs = xmlDoc.querySelectorAll("song");
    const content = document.getElementById("content");

    composers.forEach(comp => {
      const id = comp.querySelector("ID").textContent;
      const name = comp.querySelector("name").textContent;
      const family = comp.querySelector("familyname").textContent;
      const style = comp.querySelector("style").textContent;
      const birth = comp.querySelector("yearofbirth").textContent;
      const death = comp.querySelector("yearofdeath").textContent;
      const narrative = comp.querySelector("narrative").textContent;

      const composerDiv = document.createElement("div");
      composerDiv.className = "composer";
      composerDiv.innerHTML = `<h2>${name} ${family}</h2>
        <p><strong>Stijl:</strong> ${style}</p>
        <p><strong>Levensjaren:</strong> ${birth}‚Äì${death}</p>
        <p>${narrative}</p>`;

      const relatedSongs = Array.from(songs).filter(song => 
        song.querySelector("reference").textContent === id
      );

      relatedSongs.forEach(song => {
        const title = song.querySelector("title").textContent;
        const artist = song.querySelector("artist").textContent;
        const spotify = song.querySelector("spotify").textContent;
		const paras = song.querySelectorAll("narrative para");
		let songNarrative = "";
		paras.forEach(p => {
			if (p.textContent.trim()) {
				songNarrative += `<p>${p.textContent}</p>`;
			}
		}); // ‚Üê closes the forEach loop
		
        const songDiv = document.createElement("div");
        songDiv.className = "song";
        songDiv.innerHTML = `<h3>${title}</h3>
          <p><strong>Artiest:</strong> ${artist}</p>
          <p>${songNarrative}</p>
          <p><a href="${spotify}" target="_blank">üéß Luister op Spotify</a></p>`;
        composerDiv.appendChild(songDiv);
      });

      content.appendChild(composerDiv);
    });	
  });
  </script>

<script>
fetch('canon.xml')
  .then(res => res.text())
  .then(str => {
    const xml = new DOMParser().parseFromString(str, "application/xml");

    // Parse composers
    const composerNodes = [...xml.getElementsByTagName("composer")];
    const composers = {};
    composerNodes.forEach(c => {
      const id = c.getElementsByTagName("ID")[0].textContent.trim();
      composers[id] = {
        name: c.getElementsByTagName("name")[0].textContent,
        familyname: c.getElementsByTagName("familyname")[0].textContent,
        style: c.getElementsByTagName("style")[0].textContent,
        birth: c.getElementsByTagName("yearofbirth")[0].textContent,
        death: c.getElementsByTagName("yearofdeath")[0].textContent,
        narrative: c.getElementsByTagName("narrative")[0]?.textContent || ""
      };
    });

    // Parse and sort songs
    const songNodes = [...xml.getElementsByTagName("song")];
    const songs = songNodes.map(s => {
      const dateNode = s.getElementsByTagName("appenddate")[0];
      const date = new Date(
        dateNode.getElementsByTagName("year")[0].textContent,
        dateNode.getElementsByTagName("month")[0].textContent - 1,
        dateNode.getElementsByTagName("day")[0].textContent
      );
      return {
        id: s.getElementsByTagName("ID")[0].textContent,
        composerId: s.getElementsByTagName("reference")[0].textContent.trim(),
        title: s.getElementsByTagName("title")[0].textContent,
        artist: s.getElementsByTagName("artist")[0]?.textContent || "",
        spotify: s.getElementsByTagName("spotify")[0]?.textContent || "",
        narrative: [...s.getElementsByTagName("para")].map(p => p.textContent).join("<br>"),
        date
      };
    }).sort((a, b) => b.date - a.date);

    // Render songs
    const container = document.getElementById("playlist");
    songs.forEach((song, index) => {
      const composer = composers[song.composerId];
      const block = document.createElement("div");
      block.className = "song-block";

      if (index < 2) {
        block.innerHTML = `
          <h3>${composer.familyname} ‚Äì ${song.title}</h3>
          <p><strong>Stijl:</strong> ${composer.style}</p>
          <p><strong>Levensjaren:</strong> ${composer.birth}‚Äì${composer.death}</p>
          <p>${song.narrative}</p>
          ${song.artist ? `<p><strong>Artiest:</strong> ${song.artist}</p>` : ""}
          ${song.spotify ? `<p><a href="${song.spotify}" target="_blank">üéß Luister op Spotify</a></p>` : ""}`;
      } else {
        block.innerHTML = `
          <div class="collapsed" onclick="this.nextElementSibling.style.display='block'; this.style.display='none';">
            <strong>${composer.familyname}</strong> ‚Äì ${song.title}
          </div>
          <div class="expanded" style="display:none;">
            <p><strong>Stijl:</strong> ${composer.style}</p>
            <p><strong>Levensjaren:</strong> ${composer.birth}‚Äì${composer.death}</p>
            <p>${song.narrative}</p>
            ${song.artist ? `<p><strong>Artiest:</strong> ${song.artist}</p>` : ""}
            ${song.spotify ? `<iframe src="${song.spotify}" width="300" height="80"></iframe>` : ""}
          </div>
        `;
      }

      container.appendChild(block);
    });
  });
</script>

</body>
</html>



